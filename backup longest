//Use 'npm run build'

console.log("It's working 333");

//Array of task objects
let tasks = [
  createTask(
    1,
    "Walk the dog",
    "Take Bono for a 10 minute walk",
    "2023-02-07",
    "low",
    "My Tasks"
  ),
  createTask(
    2,
    "Practice guitar",
    "Learn the CAGED method",
    "2023-02-11",
    "low",
    "My Tasks"
  ),
  createTask(
    3,
    "Pay electricity bill",
    "Pay bill online",
    "2023-02-25",
    "medium",
    "My Tasks"
  ),
];

// Array of Projects
let projects = ["My Tasks"];
let selectedProject = "My Tasks";

let editingTask = false;
let editIndex;

//Toggle sidebar display
const menuButton = document.getElementById("menu-btn");
const main = document.getElementById("main");
const addTaskButton = document.getElementById("add-task-btn");
const addTaskModal = document.getElementById("add-task-modal");
const taskContainer = document.getElementById("task-container");
const completedTaskContainer = document.getElementById(
  "completed-task-container"
);
const addTaskForm = document.getElementById("add-task-form");
const projectsMenu = document.getElementById("projects-menu");

const addProjectButton = document.querySelector("#add-new-project");
const addProjectModal = document.querySelector("#add-project-modal");
const addProjectForm = document.querySelector("#add-project-form");
const projectNameInput = document.querySelector("#project-name");
const projectsContainer = document.querySelector("#projects-container");
const tasksHeading = document.querySelector("#tasks-heading");
const completedTasksHeading = document.querySelector(
  "#completed-tasks-heading"
);
const info = document.getElementById("info");

//Toggle sidebar visibility
menuButton.addEventListener("click", function () {
  main.classList.toggle("force-show");
});

// Factory function to create task objects
function createTask(id, title, description, dueDate, priority, project) {
  return {
    id,
    title,
    description,
    dueDate,
    priority,
    project,
    complete: false,
  };
}
//Display the modal

addTaskButton.addEventListener("click", () => {
  addTaskModal.style.display = "flex";
  //updateOptions();
});

// Display tasks function
function displayTasks() {
  taskContainer.innerHTML = "";

  tasks
    .filter((task) => task.project === selectedProject)
    .filter((task) => !task.complete)
    .forEach((task) => {
      const taskDiv = document.createElement("div");
      taskDiv.classList.add("task");

      const checkbox = document.createElement("input");
      checkbox.setAttribute("type", "checkbox");
      checkbox.addEventListener("click", () => {
        task.complete = !task.complete;
        displayTasks();
        displayCompletedTasks();
      });
      taskDiv.appendChild(checkbox);

      const titleDiv = document.createElement("div");
      titleDiv.innerText = task.title;
      titleDiv.classList.add("task-title");
      taskDiv.appendChild(titleDiv);

      const deleteButton = document.createElement("button");
      deleteButton.innerText = "Delete";
      deleteButton.classList.add("delete-button");
      deleteButton.addEventListener("click", () => {
        deleteTask(task.id);
      });
      taskDiv.appendChild(deleteButton);

      const editButton = document.createElement("button");
      editButton.innerText = "Edit";
      editButton.classList.add("edit-button");
      editButton.addEventListener("click", () => {
        document.getElementById("add-task-modal").style.display = "flex";
        editingTask = true;
        //editIndex = index;
        document.getElementById("task-title").value = task.title;
        document.getElementById("task-desc").value = task.description;
        document.getElementById("due-date").value = task.dueDate;
        document.getElementById("priority").value = task.priority;
        document.getElementById("project").value = task.project;
      });
      taskDiv.appendChild(editButton);

      taskContainer.appendChild(taskDiv);

      tasksHeading.innerText = selectedProject;
      info.innerText = JSON.stringify(tasks);
    });
}

// Display completed tasks function
function displayCompletedTasks() {
  completedTaskContainer.innerHTML = "";

  tasks
    .filter((task) => task.project === selectedProject)
    .filter((task) => task.complete)
    .forEach((task) => {
      const taskDiv = document.createElement("div");
      taskDiv.classList.add("task");

      const checkbox = document.createElement("input");
      checkbox.setAttribute("type", "checkbox");
      checkbox.checked = task.complete;
      checkbox.addEventListener("click", () => {
        task.complete = !task.complete;
        displayTasks();
        displayCompletedTasks();
        info.innerText = JSON.stringify(tasks);
      });
      taskDiv.appendChild(checkbox);

      const titleDiv = document.createElement("div");
      titleDiv.innerText = task.title;
      titleDiv.classList.add("task-title");
      taskDiv.appendChild(titleDiv);

      const deleteButton = document.createElement("button");
      deleteButton.innerText = "Delete";
      deleteButton.classList.add("delete-button");
      deleteButton.addEventListener("click", () => {
        deleteTask(task.id);
      });
      taskDiv.appendChild(deleteButton);

      const editButton = document.createElement("button");
      editButton.innerText = "Edit";
      editButton.classList.add("edit-button");
      editButton.addEventListener("click", () => {
        document.getElementById("add-task-modal").style.display = "flex";
        editingTask = true;
        //editIndex = index;
        document.getElementById("task-title").value = task.title;
        document.getElementById("task-desc").value = task.description;
        document.getElementById("due-date").value = task.dueDate;
        document.getElementById("priority").value = task.priority;
        document.getElementById("project").value = task.project;
      });
      taskDiv.appendChild(editButton);

      completedTaskContainer.appendChild(taskDiv);

      info.innerText = JSON.stringify(tasks);
    });
}

// Delete task function
function deleteTask(id) {
  tasks = tasks.filter((task) => task.id !== id);
  displayTasks();
  displayCompletedTasks();
  info.innerText = JSON.stringify(tasks);
}

/*
// Edit task function
function editTask(id, title, desc, dueDate, priority, project) {
  tasks = tasks.map((task) =>
    task.id === id
      ? { ...task, title, description: desc, dueDate, priority, project }
      : task
  );
  displayTasks();
  displayCompletedTasks();
}
*/

// Add task function
function addTask() {
  const title = document.getElementById("task-title").value;
  const description = document.getElementById("task-desc").value;
  const dueDate = document.getElementById("due-date").value;
  const priority = document.getElementById("priority").value;
  const project = document.getElementById("project").value;

  /*
  if (editingTask && tasks[editIndex]) {
    editTask(tasks[editIndex].id, title, desc, dueDate, priority, project);
    editingTask = false;
    addTaskModal.style.display = "none";
  } else {
    const id = tasks.length ? Math.max(...tasks.map((task) => task.id)) + 1 : 1;
    tasks.push(createTask(id, title, desc, dueDate, priority, project));
    displayTasks();
  }
*/

  if (editingTask) {
    tasks[editIndex].title = title;
    tasks[editIndex].description = description;
    tasks[editIndex].dueDate = dueDate;
    tasks[editIndex].priority = priority;
    tasks[editIndex].project = project;
    editingTask = false;
  } else {
    const task = createTask(
      tasks.length + 1,
      title,
      description,
      dueDate,
      priority,
      project
    );
    tasks.push(task);
  }

  addTaskModal.style.display = "none";
  addTaskForm.reset();

  displayTasks();
  displayCompletedTasks();
}

//Submitting the form calls the 'addTask' function
addTaskForm.addEventListener("submit", (event) => {
  event.preventDefault();
  addTask();
});

// Show the modal when the add project button is clicked
addProjectButton.addEventListener("click", () => {
  addProjectModal.style.display = "flex";
});

// Add the project to the projects array and update the projects list in the DOM
addProjectForm.addEventListener("submit", (event) => {
  event.preventDefault();
  addProject();
});

function addProject() {
  // Get the project name from the input
  const projectName = projectNameInput.value;

  // Add the project name to the projects array
  projects.push(projectName);

  // Update the projects list in the DOM
  projectsContainer.innerHTML = "";
  projects.forEach((project) => {
    const projectItem = document.createElement("div");
    projectItem.innerText = project;
    projectItem.classList.add("project-item");
    projectItem.addEventListener("click", () => {
      selectedProject = project;
      console.log(selectedProject);

      displayTasks();
      displayCompletedTasks();
      info.innerText = JSON.stringify(tasks);
    });
    projectsContainer.appendChild(projectItem);
  });
  console.log(selectedProject);

  // Reset the form
  addProjectForm.reset();

  // Hide the modal
  addProjectModal.style.display = "none";

  console.log(projects);
  updateOptions();

  info.innerText = JSON.stringify(tasks);
}

//Update 'Project' options in the form upon initial load
const projectSelect = document.querySelector("#project");
projectSelect.value = selectedProject;

//Function for updating the select dropdown
function updateOptions() {
  projectSelect.innerHTML = "";
  projectSelect.value = selectedProject;
  projects.forEach((project) => {
    if (project) {
      const option = document.createElement("option");
      option.value = project;
      option.innerText = project;
      projectSelect.appendChild(option);
    }
  });
}

displayTasks();
displayCompletedTasks();
addProject();
info.innerText = JSON.stringify(tasks);
